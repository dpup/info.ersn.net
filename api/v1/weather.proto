syntax = "proto3";

package api.v1;

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/dpup/info.ersn.net/server/api/v1";

// WeatherService provides current weather conditions and alerts
service WeatherService {
  // ListWeather returns current weather for all configured locations
  rpc ListWeather(ListWeatherRequest) returns (ListWeatherResponse) {
    option (google.api.http) = {
      get: "/api/v1/weather"
    };
  }

  // GetLocationWeather returns weather for a specific location
  rpc GetLocationWeather(GetLocationWeatherRequest) returns (GetLocationWeatherResponse) {
    option (google.api.http) = {
      get: "/api/v1/weather/{location_id}"
    };
  }

  // ListWeatherAlerts returns active weather alerts for all locations
  rpc ListWeatherAlerts(ListWeatherAlertsRequest) returns (ListWeatherAlertsResponse) {
    option (google.api.http) = {
      get: "/api/v1/weather/alerts"
    };
  }
}

// Request messages
message ListWeatherRequest {}

message GetLocationWeatherRequest {
  string location_id = 1;
}

message ListWeatherAlertsRequest {}

// Response messages
message ListWeatherResponse {
  repeated WeatherData weather_data = 1;
  google.protobuf.Timestamp last_updated = 2;
}

message GetLocationWeatherResponse {
  WeatherData weather_data = 1;
  google.protobuf.Timestamp last_updated = 2;
}

message ListWeatherAlertsResponse {
  repeated WeatherAlert alerts = 1;
  google.protobuf.Timestamp last_updated = 2;
}

// Data models
message WeatherData {
  string location_id = 1;                    
  string location_name = 2;                  
  string weather_main = 3;                   // "Clear", "Rain", "Snow", etc.
  string weather_description = 4;            // "light rain", "clear sky", etc.
  string weather_icon = 5;                   // Icon code for display
  int32 temperature_celsius = 6;             // Temperature in Celsius (rounded)
  int32 feels_like_celsius = 7;              // Feels like temperature in Celsius (rounded)
  int32 humidity_percent = 8;                // Humidity percentage (0-100)
  int32 wind_speed_kmh = 9;                  // Wind speed in km/h (more user-friendly)
  int32 wind_direction_degrees = 10;         // Wind direction in degrees (0-360) 
  int32 visibility_km = 11;                  // Visibility distance in kilometers
  repeated WeatherAlert alerts = 12;         // Active weather alerts
}


// Removed WeatherCondition - data is now directly in WeatherData message

message WeatherAlert {
  string id = 1;                             // Generated unique identifier
  string sender_name = 2;                    // Alert issuing organization
  string event = 3;                          // Alert event type ("Heat Advisory", "Winter Storm Warning")
  int64 start_timestamp = 4;                 // Unix timestamp when effective
  int64 end_timestamp = 5;                   // Unix timestamp when expires
  string description = 6;                    // Alert description text
  repeated string tags = 7;                  // OpenWeatherMap alert tags
}

// Enumerations

// OpenWeatherMap alert tags (14 categories) - preserved as reference
// Actual alert classification is done via the "tags" string array field
// which contains the original OpenWeatherMap tag values:
// - "extreme temperature value", "fog", "high wind", "thunderstorms" 
// - "tornado", "hurricane/typhoon", "snow", "ice", "rain"
// - "coastal event", "volcano", "tsunami", "other"